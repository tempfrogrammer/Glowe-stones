<html lang="ru">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Rocks DB</title>

<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Roboto+Condensed:wght@100&display=swap" rel="stylesheet">

<style>
	@font-face {
		font-family: "Pearl";
		src: url("./fonts/Pearl.woff2") format("woff2");
		font-weight: normal;
		font-style: normal;
	}
	body { 
		font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial; 
		margin: 16px; 
		background: linear-gradient(
			to bottom, 
			rgb(12, 23, 45) 5%, 
			rgb(7, 32, 36) 50%);

		background-attachment: fixed;
	}

	.row { 
		display: flex; 
		gap: 12px; 
		flex-wrap: wrap; 
		align-items: center; 
		margin-bottom: 30px;
		justify-content: center;
	}
	.toolbar { 
		top: 0; 
		padding: 30px ; 
		color:white;
		border-radius:30px;
	}
	@keyframes glowPulse {
		0% {box-shadow: 0 0px 0px rgba(47, 197, 252, .1);}
		50% {box-shadow: 0 0px 70px rgb(43, 120, 255, .5);}
		100% {box-shadow: 0 0px 0px rgba(47, 197, 252, .1);}
	}

	.category-grid {
		display: grid;
		grid-template-columns: repeat(4, 1fr);
		grid-template-rows: repeat(2, 1fr);
		grid-column-gap: 20px;
	}

	.d1 { grid-area: 1 / 1 / 2 / 2; }
	.d2 { grid-area: 1 / 2 / 2 / 3; }
	.d3 { grid-area: 1 / 3 / 2 / 4; }
	.d4 { grid-area: 1 / 4 / 2 / 5; }
	.d5 { grid-area: 2 / 1 / 3 / 2; }
	.d6 { grid-area: 2 / 2 / 3 / 3; }
	.d7 { grid-area: 2 / 3 / 3 / 4; }
	.d8 { grid-area: 2 / 4 / 3 / 5; }

	.d1, .d2, .d3, .d4 {
		margin: 0;
		font-family: 'Pearl';
		font-size: 30px;
		text-align: center;
	}
	.d5,.d6,.d7,.d8{
		background-image: url(./line2.png);
		background-position: center;
		background-repeat: no-repeat;
		background-size: contain;
		opacity: 50%;
		height: 10px;
		filter: invert();
	}

	.tags { 
		display: flex; 
		gap: 8px; 
		flex-wrap: wrap; 
	}
	#tags {
		margin-top: -20px;
		display: grid;
		grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
		gap: 20px;
		align-items: start;
	}
	.tag-group {
		display: flex;
		flex-direction: column;
		padding: 0 0 0 40px;
	}
	.tag-buttons {
		display: flex;
		flex-wrap: wrap;
		gap: 6px;
	}

	button.tag {
		border: 1px solid #aaaaaa00; 
		padding: 6px 10px; 
		border-radius: 999px; 
		background: #ffffff;
		cursor: pointer; 
		user-select: none;
	}
	
	.cards { 
		display: grid; 
		grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); 
		gap: 20px; 
		margin-top: 20px; 
	}
	.card { 
		margin:4px;
		display: flex;
		flex-direction: column;
		justify-content: space-between;
		background: linear-gradient(30deg, rgb(21, 38, 71), rgb(9, 54, 60)) ; 
		background-position: top right ;
		height: 530px;
		border-radius: 30px; 
		color:white;
	}
	
	.card1{
		height: 50%;
		padding:25px 20px 20px 20px;
	}
	.card1 h3 { 
		margin: 0 0 40px 0; 
		font-size: 20px; 
		font-family: "Pearl", sans-serif;
		font-optical-sizing: auto;
		font-weight: 100;
		font-style: normal;
		text-align: center;
		line-height: 1;
	}

	.card1 ul { 
		list-style: none;
		padding: 0px 0px 0px 0px;
		margin: 0;
		font-size: 16px;
	}
	.card1 ul li{
		padding: 5px 10px 5px 20px;
		background-color: #ffffff;
		color:black;
		margin-top: 10px;
		border-radius: 5px;
	}
	.card2{
		border-radius: 22px;
	}
	.stones-grid {
		display: grid;
		grid-template-columns: repeat(2,50%);
		gap: 10px;
		padding:0px 30px 20px 20px;
		hyphens:auto;
	}
	.stone-item {
		color: #ffffff;
		border-radius: 5px;
		padding: 6px 8px;
		font-size: 18px;
		line-height: 1.2;
		height: 65px;
	}
	
	.stone-wind {
		border:2px solid #4fc3f7;
	}
	.stone-fire {
		border:2px solid #d84315;
	}
	.stone-green {
		border:2px solid #558b2f;
	}
	.stone-earth {
		border:2px solid #f9a825;
	}
	.stone-rainbow {
		border:2px solid #f869fff7;
	}

	input[type="search"] { 
		padding: 8px 10px; 
		border: 1px solid #aaa; 
		border-radius: 50px; 
		min-width: 240px; 
	}
	button.tag:hover{
		transform: scale(1.05);
		transition: transform 0.1s ease-in-out;
		filter:drop-shadow();
	}
	button.tag.red {
		color:white;
		background:#fe6a0d;
	}
	button.tag.blue {
		color:white;
		background:#6889ec;
	}
	button.tag.green {
		background:#b7ff58;
	}
	button.tag.white {
		background:#dcdcdc;
	}

	button.tag.active { 
		background: #000000; 
		color: #fff; 
		border-color: #11111100; 
		filter: drop-shadow(0 0px 15px rgba(58, 238, 250, 0.639));
	}


	#reset{
		color: rgb(27, 27, 27);
		background-color: #ffffff;
		border-radius: 50px; 
		padding: 8px 10px; 
		border: 1px solid #ffffff; 	
		cursor: pointer; 
		user-select: none;
	}

	#title{
		font-family: 'Pearl', Arial, Helvetica, sans-serif;
		font-size: 70px;
		margin: 0;
		margin-top:40px;
		margin-bottom: 40px;
		color:rgb(255, 255, 255);
		text-align: center;
		text-transform: uppercase;
		-webkit-text-stroke: 2px rgb(255, 255, 255);
	}
	.TITLE {
		display: flex;
		align-items: center;
		justify-content: center;
		gap: 30px;
	}
	.TITLE::before	{
		
		transform: scale(2);
		content: "";
		width: 200px;    
		height: 12px;    	

		background-image: url("./line.png");
		filter: brightness(5);
		background-size: contain;
		background-repeat: no-repeat;
		background-position: center;
	}
	.TITLE::after {
		transform:scale(2) scaleX(-1);
		filter: brightness(5);

		background-image: url("./line.png");
		background-size: contain;
		background-repeat: no-repeat;
		background-position: center;
		content: "";
		width: 200px;     
		height: 12px;     
	}
	


	@keyframes jitterSoft {
		0%   { transform: translateX(0px) rotate(0deg); }
		25%  { transform: translateX(-0.6px) rotate(-0.6deg); }
		50%  { transform: translateX(0.6px) rotate(0.3deg); }
		75%  { transform: translateX(-0.4px) rotate(-0.3deg); }
		100% { transform: translateX(0px) rotate(0deg); }
	}

	button.tag.active {
		animation: jitterSoft 0.8s ease-in-out infinite;
	}


</style>
</head>
<body>
	<p id="title" class="TITLE">Светящиeся камни</p>
	<div class="toolbar">
		<div class="row">
			<input id="q" type="search" placeholder="Поиск по названию/эффектам/камням..." />
	
			<button id="reset">Сброс</button>
		</div>
		<div class="category-grid">
			<p class="d1">Бой</p>
			<p class="d2">Сопротивление</p>
			<p class="d3">Ремесло</p>
			<p class="d4">Остальное</p>
			<div class="d5"></div>
			<div class="d6"></div>
			<div class="d7"></div>
			<div class="d8"></div>
		</div>

		<div id="tags" class="tags"></div>
	</div>

	<div id="cards" class="cards"></div>

<script>
(() => {
	const state = {
	items: [],
	selected: new Set(),
	mode: "or",
	query: ""
	};

	const TAG_LABELS = {
		exp: "Боевой опыт",
		pexp: "Опыт навыков",
		atc_monster: "Доп. урон монстрам",
		atc_human: "Доп. урон (люди)",
		atc_ain: "Доп. урон (аины)",
		atc_kama: "Доп. урон монстрам Камасильвии",
		atc_idan: "Доп. атака по монстрам Идании",
		atc_decrease_monster: "Урон от монстров",
		damage_decrease_monster: "Снижение урона от монстров",
		hp_max: "Макс. HP",
		atc_ground: "Урон от атаки по низу",
		atc_crit: "Урон крит. удара",
		atc_back: "Урон от атак в спину",
		def_all: "Все сопротивление",
		atc_all: "Вся атака",
		luck: "Шанс получения трофеев",
		speed: "Скорость передвижения",
		mass: "Макс. грузоподъемность",
		cloth: "Уменьшение износа снаряжения",
		karma: "Восстановление кармы",
		know: "Шанс получения знаний",
		know_high: "Шанс получения знаний выс. уровня",
		fall_damage: "Урон от падения",
		all_accu: "Вся меткость",
		stamina: "Макс. выносливость",
		atc_air: "Урон от атаки в воздухе",
		atc_special: "Доп. урон от всех особых атак",
		all_evas: "Все уклонение",
		all_damage_decrease: "Снижение всего урона",
		resist_ooz: "Cопротивление ошеломлению/оглушению/заморозке",
		resist_no: "Сопротивление нокдауну/опрокидыванию",
		resist_op: "Сопротивление отталкиванию/подбрасыванию",
		black: "Восстановление Гнева Черного духа",
		mpfpdp: "Макс. MP/FP/DP",
		jump: "Сила прыжка",
		live_exp: "Ремесленный опыт",
		master_exp: "Мастерство ремесла",
		gath_exp: "Опыт сбора",
		fish_exp: "Опыт рыбалки",
		hunt_exp: "Опыт охоты",
		meal_exp: "Опыт кулинарии",
		alch_exp: "Опыт алхимии",
		make_exp: "Опыт изготовления",
		horse_exp: "Опыт укрощения",
		trade_exp: "Опыт торговли",
		garden_exp: "Опыт урожая",
		ship_exp: "Опыт судоходства",
		barter_exp: "Опыт бартера",
		m_gath: "Мастерство сбора",
		m_fish: "Мастерство рыбалки",
		m_hunt: "Мастерство охоты",
		m_meal: "Мастерство кулинарии",
		m_alch: "Мастерство алхимии",
		m_make: "Мастерство изготовления",
		m_horse: "Мастерство укрощения",
		m_ship: "Мастерство судоходства",
		gath_rate: "Шанс получения предметов при сборе",
		gath_speed: "Скорость сбора",
		energy: "Восстановление энергии",
		fish_auto: "Время авторыбалки",
		fish_speed: "Скорость рыбалки",
		fish_big: "Повышение шанса поймать крупную рыбу",
		fish_rare: "Повышение шанса поймать редкую рыбу",
		perk_speed: "Скорость навыков",
		crit_rate: "Шанс крит. удара",
		atc_speed: "Скорость атаки",
		crit_plus: "Крит. удар",
		gun_reload: "Скорость перезарядки ружья",
		meal_time: "Время кулинарии",
		alch_time: "Время алхимии",
		make_rate: "Шанс успешного изготовления",
		mount_exp: "Опыт транспорта",
		mermaid: "Желание русалки III"
	};
	const TAG_COLOR = {
		pexp:"red",
		exp:"red",
		atc_all: "red",
		atc_monster: "red",
		atc_human: "red",
		atc_ain: "red",
		atc_kama: "red",
		atc_idan: "red",
		atc_ground: "red",
		atc_air: "red",
		atc_back: "red",
		atc_crit: "red",
		atc_special: "red",
		crit_rate: "red",
		crit_plus: "red",
		atc_speed: "red",
		all_accu: "red",

		mpfpdp:"blue",
		def_all: "blue",
		all_evas: "blue",
		all_damage_decrease: "blue",
		damage_decrease_monster: "blue",
		atc_decrease_monster: "blue",
		resist_ooz: "blue",
		resist_no: "blue",
		resist_op: "blue",
		hp_max: "blue",
		stamina: "blue",

		live_exp:"green",
		horse_exp:"green",
		mount_exp:"green",
		master_exp:"green",
		gath_exp: "green",
		fish_exp: "green",
		hunt_exp: "green",
		meal_exp: "green",
		alch_exp: "green",
		make_exp: "green",
		trade_exp: "green",
		garden_exp: "green",
		ship_exp: "green",
		barter_exp: "green",
		m_gath: "green",
		m_fish: "green",
		m_hunt: "green",
		m_meal: "green",
		m_alch: "green",
		m_make: "green",
		m_horse: "green",
		m_ship: "green",
		gath_rate: "green",
		gath_speed: "green",
		fish_auto: "green",
		fish_speed: "green",
		fish_big: "green",
		fish_rare: "green",
		meal_time: "green",
		alch_time: "green",
		make_rate: "green",
	};
	const TAG_LAYOUT   = {
		red: [
			"exp",
			"pexp",
			"atc_all",
			"all_accu",
			"all_evas",
			"perk_speed",
			"atc_speed",
			"crit_plus",
			"crit_rate",
			"atc_ground",
			"atc_crit",
			"atc_back",
			"atc_air",
			"atc_special",
			"atc_monster",
			"atc_human",
			"atc_ain",
			"atc_kama",
			"atc_idan"
		],

		blue: [
			"atc_decrease_monster",
			"damage_decrease_monster"     ,
			"def_all"                     ,
			"all_damage_decrease"         ,
			"hp_max"                      ,
			"mpfpdp"                      ,
			"stamina"                     ,
			"resist_ooz"                  ,
			"resist_no"                   ,
			"resist_op"
		],

		green: [
			"live_exp"                    ,
			"master_exp"                  ,
			"gath_exp"                    ,
			"fish_exp"                    ,
			"hunt_exp"                    ,
			"meal_exp"                    ,
			"alch_exp"                    ,
			"make_exp"                    ,
			"horse_exp"                   ,
			"garden_exp"                  ,
			"mount_exp"                   ,
			"trade_exp"                   ,
			"ship_exp"                    ,
			"barter_exp"                  ,
			"m_gath"                      ,
			"m_fish"                      ,
			"m_hunt"                      ,
			"m_meal"                      ,
			"m_alch"                      ,
			"m_make"                      ,
			"m_horse"                     ,
			"m_ship"                      ,
			"gath_speed"                  ,
			"fish_speed"                  ,
			"fish_auto"                   ,
			"meal_time"                   ,
			"alch_time"                   ,
			"make_rate"
		],

		white: [
			"fall_damage",                 
			"energy",                      
			"mass",                        
			"speed",                       
			"know",                        
			"mermaid",                     
			"know_high",                   
			"black",                       
			"luck",                        
			"gath_rate",                   
			"fish_big",                    
			"karma" ,
			"jump",                        
			"fish_rare",                   
			"gun_reload",                  
			"cloth",                       
		]
	};

	const $tags = document.getElementById("tags");
	const $cards = document.getElementById("cards");
	const $q = document.getElementById("q");
	const $mode = document.getElementById("mode");
	const $reset = document.getElementById("reset");

	function uniqTags(items) {
		const s = new Set();
		for (const it of items) {
			if (Array.isArray(it.tag)) for (const t of it.tag) s.add(t);
		}
		return Array.from(s).sort();
	}

	function renderTags(allTags) {
		$tags.innerHTML = "";

		const order = ["red", "blue", "green", "white"];

		const buckets = { red: [], blue: [], green: [], white: [] };

		for (const tag of allTags) {
			const color = TAG_COLOR[tag] || "white";
			buckets[color].push(tag);
		}

		for (const color of order) {

			const list = (TAG_LAYOUT && TAG_LAYOUT[color] && TAG_LAYOUT[color].length)
				? TAG_LAYOUT[color]
				: buckets[color];

			if (!list || !list.length) continue;

			const group = document.createElement("div");
			group.className = "tag-group";


			const btnWrap = document.createElement("div");
			btnWrap.className = "tag-buttons";

			for (const tag of list) {
				if (allTags.indexOf(tag) === -1) continue;

				const btn = document.createElement("button");
				btn.className = "tag " + color;
				btn.dataset.tag = tag;
				btn.textContent = TAG_LABELS[tag] || tag;

				btn.addEventListener("click", () => {
					if (state.selected.has(tag)) state.selected.delete(tag);
					else state.selected.add(tag);
					render();
				});

				btnWrap.appendChild(btn);
			}

			group.appendChild(btnWrap);
			$tags.appendChild(group);

		}
	};

	function matchQuery(item, q) {
		if (!q) return true;
		const hay = [
		item.name || "",
		...(item.effects || []),
		...(item.stones || [])
		].join(" ").toLowerCase();
		return hay.includes(q.toLowerCase());
	};

	function matchTags(item) {
		const sel = state.selected;
		if (sel.size === 0) return true;

		const tags = item.tag || [];
		if (state.mode === "or") {
			for (const t of sel) if (tags.includes(t)) return true;
			return false;
		} else { 
			for (const t of sel) if (!tags.includes(t)) return false;
			return true;
		}
	};

	function filteredItems() {
		const out = [];
		for (const it of state.items) {
			if (!matchQuery(it, state.query)) continue;
			if (!matchTags(it)) continue;
			out.push(it);
		}
		return out;
	};

	function getStoneClass(name) {

		if (name.includes("Ветер"))
			return "stone-wind";

		if (name.includes("Огонь"))
			return "stone-fire";

		if (name.includes("Земля"))
			return "stone-earth";

		if (name.includes("Зелень"))
			return "stone-green";
		
		if (name.includes("Разноцветный"))
			return "stone-rainbow";
	};

	function renderCards(items) {
		$cards.innerHTML = "";

		for (const it of items) {
			const card = document.createElement("div");
			card.className = "card";
			
			const card1 = document.createElement("div");
			card1.className = "card1";

			const card2 = document.createElement("div");
			card2.className = "card2";

			const title = document.createElement("h3");
			const name = (it.name || "(без названия)").trim();

			title.append(name);

			const effList = document.createElement("ul");
			for (const e of (it.effects || [])) {
				const li = document.createElement("li");
				li.textContent = e;
				effList.appendChild(li);
			}

			const stonesGrid = document.createElement("div");
			stonesGrid.className = "stones-grid";

			for (const s of it.stones || []) {
				const stone = document.createElement("div");

				const colorClass = getStoneClass(s);
				stone.className = "stone-item " + colorClass;

				const parts = s.split(" ");
				const first = parts.shift();
				const bold = document.createElement("b");
				let text = first;

				if (text === "Разноцветный") {
					text = "Разно<wbr>цветный";
				}
				
				bold.innerHTML = text;

				stone.appendChild(bold);

				
				const rest = parts.join(" ");

				let second = rest;

				if (second === "Преобразование") {
					second = "Преобразо&shy;вание";
				}

				if (second === "Грузоподъемность") {
					second = "Грузоподъ&shy;емность";
				}
				

				if (second) {
					stone.appendChild(document.createElement("br"));

					const span = document.createElement("span");

					span.innerHTML = second;

					stone.appendChild(span);
				}

				stonesGrid.appendChild(stone);
			}

			card.appendChild(card1);
			card.appendChild(card2);

			card1.appendChild(title);
			card1.appendChild(effList);
			
			card2.appendChild(stonesGrid);
			$cards.appendChild(card);
		}
	};

	function syncActiveButtons() {
		const buttons = $tags.querySelectorAll("button.tag");
		buttons.forEach(btn => {
			const t = btn.dataset.tag;
			btn.classList.toggle("active", state.selected.has(t));
		});
	};

	function render() {
		const items = filteredItems();
		syncActiveButtons();
		renderCards(items);
		saveStateToURL();
	};

	function saveStateToURL() {
		const params = new URLSearchParams();

		if (state.selected.size) {
			params.set("tags", Array.from(state.selected).join(","));
		} else {
			params.delete("tags");
		}

		if (state.query) {
			params.set("q", state.query);
		} else {
			params.delete("q");
		}

		const qs = params.toString();
		history.replaceState(null, "", location.pathname + (qs ? "?" + qs : ""));
	}

	async function init() {
		const res = await fetch("./rocks_tagged.json");
		state.items = await res.json();

		function loadStateFromURL() {
			const params = new URLSearchParams(location.search);

			const tags = params.get("tags");
			state.selected.clear();
			if (tags) {
				tags.split(",").forEach(t => {
					if (t) state.selected.add(t);
				});
			}

			const q = params.get("q");
			if (q) {
				state.query = q;
				$q.value = q;
			}
		};

		loadStateFromURL();

		renderTags(uniqTags(state.items));

		$q.addEventListener("input", () => {
			state.query = $q.value.trim();
			render();
		});


		$reset.addEventListener("click", () => {
		state.selected.clear();
		state.query = "";
		$q.value = "";
		render();
		});
		
		render();
	};

	init().catch(err => {
		console.error(err);
	});
})();
</script>
</body>
</html>
